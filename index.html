<!DOCTYPE html>
<html lang="uk" data-theme="dark">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–¢–°–ù –ù–æ–≤–∏–Ω–∏</title>
<style>
  :root {
    --bg-color: #fff;
    --text-color: #111;
    --accent-color: #c70000;
    --accent-color-hover: #9c0000;
    --card-bg: #fefefe;
    --border-color: #ddd;
    --header-height: 60px;
    --font-primary: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    --shadow-light: 0 2px 10px rgba(0,0,0,0.1);
  }
  [data-theme="dark"] {
    --bg-color: #121212;
    --text-color: #e0e0e0;
    --accent-color: #e53935;
    --accent-color-hover: #b71c1c;
    --card-bg: #1e1e1e;
    --border-color: #333;
    --shadow-light: 0 2px 12px rgba(0,0,0,0.7);
  }

  * {
    box-sizing: border-box;
    scroll-behavior: smooth;
  }

  body {
    margin: 0;
    font-family: var(--font-primary);
    background-color: var(--bg-color);
    color: var(--text-color);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    line-height: 1.5;
    min-height: 100vh;
    position: relative;
  }

  aside {
    width: 240px;
    background: var(--card-bg);
    border-right: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    padding: 1.2rem 1rem;
    gap: 0.7rem;
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    overflow-y: auto;
    box-shadow: 2px 0 8px rgba(0,0,0,0.1);
    z-index: 1000;
    user-select: none;
  }

  aside button {
    background: none;
    border: none;
    color: var(--text-color);
    text-align: left;
    padding: 0.8rem 1.2rem;
    font-size: 1.1rem;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.25s ease, color 0.25s ease;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  aside button:hover,
  aside button.active {
    background-color: var(--accent-color);
    color: white;
    box-shadow: 0 0 8px var(--accent-color);
  }

  header {
    position: fixed;
    top: 0;
    left: 240px;
    right: 0;
    height: var(--header-height);
    background-color: var(--accent-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 2rem;
    font-weight: 700;
    font-size: 1.6rem;
    user-select: none;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    z-index: 2000;
  }

  #login-btn {
    background: transparent;
    border: 2px solid rgba(255,255,255,0.85);
    border-radius: 6px;
    color: white;
    font-size: 0.9rem;
    cursor: pointer;
    padding: 0.3rem 1rem;
    font-weight: 600;
    transition: background-color 0.3s, border-color 0.3s;
    user-select: none;
    margin-left: 1rem;
  }
  #login-btn:hover {
    background-color: white;
    color: var(--accent-color);
    border-color: white;
    box-shadow: 0 0 8px white;
  }

  #notification-toggle {
    margin-left: 1rem;
    background: transparent;
    border: 2px solid white;
    border-radius: 16px;
    padding: 0.3rem 1rem;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.3s, border-color 0.3s, color 0.3s;
  }
  #notification-toggle.active {
    background-color: white;
    color: var(--accent-color);
    border-color: white;
  }
  #notification-toggle:hover {
    background-color: white;
    color: var(--accent-color);
    border-color: white;
  }

  main {
    margin-left: 240px;
    margin-top: var(--header-height);
    padding: 2rem 3rem;
    max-width: 960px;
    user-select: text;
  }

  section {
    display: none;
    animation: fadeIn 0.5s ease forwards;
  }
  section.active {
    display: block;
  }

  @keyframes fadeIn {
    from {opacity: 0;}
    to {opacity: 1;}
  }

  .tag-filter {
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    font-weight: 700;
    font-size: 1rem;
  }
  .tag-filter label {
    user-select: none;
  }
  .tag-filter select {
    padding: 0.5rem 0.8rem;
    border-radius: 8px;
    border: 1px solid var(--border-color);
    background: var(--card-bg);
    color: var(--text-color);
    font-size: 1rem;
    cursor: pointer;
    transition: border-color 0.25s ease;
    user-select: none;
  }
  .tag-filter select:hover,
  .tag-filter select:focus {
    border-color: var(--accent-color);
    outline: none;
    box-shadow: 0 0 6px var(--accent-color);
  }

  .news {
    background-color: var(--card-bg);
    padding: 1.5rem 2rem;
    margin-bottom: 1.8rem;
    border-left: 6px solid var(--accent-color);
    border-radius: 12px;
    box-shadow: var(--shadow-light);
    position: relative;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: default;
  }
  .news:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
  }

  .news-tag {
    font-weight: 700;
    color: var(--accent-color);
    font-size: 1.05rem;
    margin-bottom: 0.4rem;
    user-select: none;
    letter-spacing: 0.03em;
  }

  .news time {
    font-size: 0.8rem;
    color: gray;
    display: block;
    margin-top: 1rem;
    font-style: italic;
    user-select: none;
  }

  .news .actions {
    margin-top: 1.2rem;
    display: flex;
    gap: 0.9rem;
    flex-wrap: wrap;
  }

  .news .actions button {
    font-size: 0.85rem;
    background: var(--accent-color);
    border: none;
    color: white;
    padding: 0.45rem 1.1rem;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.3s ease;
    user-select: none;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }
  .news .actions button:hover {
    background: var(--accent-color-hover);
    box-shadow: 0 4px 14px var(--accent-color-hover);
  }

  .form-section {
    background: var(--card-bg);
    padding: 1.8rem 2rem;
    border: 1px solid var(--border-color);
    border-radius: 14px;
    margin-bottom: 2rem;
    box-shadow: var(--shadow-light);
  }

  h3 {
    margin-top: 0;
    margin-bottom: 1.2rem;
    font-weight: 700;
    font-size: 1.6rem;
    letter-spacing: 0.05em;
    user-select: none;
    color: var(--accent-color);
  }

  input, textarea, select {
    width: 100%;
    margin-top: 0.7rem;
    padding: 0.7rem 1rem;
    border: 1.5px solid var(--border-color);
    border-radius: 10px;
    background: var(--card-bg);
    color: var(--text-color);
    font-size: 1rem;
    font-weight: 500;
    resize: vertical;
    transition: border-color 0.25s ease;
    user-select: text;
    font-family: var(--font-primary);
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.07);
  }
  input:hover, textarea:hover, select:hover,
  input:focus, textarea:focus, select:focus {
    border-color: var(--accent-color);
    outline: none;
    box-shadow: 0 0 10px var(--accent-color);
  }

  #editor {
    min-height: 160px;
    padding: 1.2rem;
    border: 1.5px solid var(--border-color);
    border-radius: 10px;
    background: var(--card-bg);
    outline: none;
    overflow-y: auto;
    margin-bottom: 0.8rem;
    font-size: 1rem;
    font-weight: 500;
    line-height: 1.4;
    user-select: text;
    box-shadow: inset 0 1px 6px rgba(0,0,0,0.08);
  }

  #preview-image {
    margin-top: 0.8rem;
    max-width: 100%;
    border-radius: 12px;
    box-shadow: var(--shadow-light);
    display: none;
    user-select: none;
  }

  button {
    background: var(--accent-color);
    border: none;
    color: white;
    padding: 0.7rem 1.6rem;
    border-radius: 12px;
    font-weight: 700;
    cursor: pointer;
    margin-top: 0.8rem;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    user-select: none;
    box-shadow: 0 3px 10px rgba(0,0,0,0.15);
    font-size: 1.1rem;
  }
  button:hover {
    background: var(--accent-color-hover);
    box-shadow: 0 6px 20px var(--accent-color-hover);
  }

  .admin-section {
    display: none;
  }

  /* Scrollbar for editor */
  #editor::-webkit-scrollbar {
    width: 10px;
  }
  #editor::-webkit-scrollbar-thumb {
    background: var(--accent-color);
    border-radius: 6px;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
  }
  #editor::-webkit-scrollbar-track {
    background: var(--card-bg);
    border-radius: 6px;
  }

  /* Modal styles for preview */
  #preview-modal {
    display: none;
    position: fixed;
    top: 0; left: 0; right:0; bottom:0;
    background: rgba(0,0,0,0.6);
    justify-content: center;
    align-items: center;
    z-index: 9999;
    user-select: none;
  }
  #preview-content {
    background: var(--card-bg);
    color: var(--text-color);
    padding: 2rem 2.5rem;
    border-radius: 16px;
    max-width: 750px;
    max-height: 85vh;
    overflow-y: auto;
    box-shadow: 0 0 30px rgba(0,0,0,0.5);
    position: relative;
    user-select: text;
  }
  #preview-content .news-tag {
    font-weight: 700;
    color: var(--accent-color);
    margin-bottom: 1.5rem;
    font-size: 1.3rem;
    letter-spacing: 0.05em;
    user-select: none;
  }
  #preview-content time {
    font-size: 0.85rem;
    color: gray;
    margin-top: 1.8rem;
    display: block;
    font-style: italic;
    user-select: none;
  }
  #preview-close {
    position: absolute;
    top: 12px;
    right: 18px;
    background: transparent;
    border: none;
    font-size: 2.2rem;
    cursor: pointer;
    color: var(--accent-color);
    font-weight: 700;
    user-select: none;
    transition: color 0.3s ease;
  }
  #preview-close:hover {
    color: var(--accent-color-hover);
  }

  /* –í—Ö–æ–¥–Ω–∞—è –ø–∞–Ω–µ–ª—å */
  #login-panel {
    display: none;
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: var(--card-bg);
    padding: 2.2rem 3rem;
    border-radius: 16px;
    box-shadow: 0 0 25px rgba(0,0,0,0.7);
    z-index: 10000;
    user-select: none;
    width: 320px;
  }
  #login-panel h3 {
    margin: 0 0 1.2rem 0;
    color: var(--accent-color);
    font-weight: 700;
    font-size: 1.8rem;
    user-select: none;
    text-align: center;
  }
  #writer-pass {
    font-size: 1.1rem;
    padding: 0.6rem 1rem;
    border-radius: 12px;
    border: 1.5px solid var(--border-color);
    width: 100%;
    box-sizing: border-box;
    background: var(--card-bg);
    color: var(--text-color);
    user-select: text;
    margin-bottom: 1.8rem;
    transition: border-color 0.25s ease;
  }
  #writer-pass:focus {
    outline: none;
    border-color: var(--accent-color);
    box-shadow: 0 0 10px var(--accent-color);
  }
  #login-panel .btns {
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
  }
  #login-panel button {
    font-size: 1.1rem;
    padding: 0.6rem 1.4rem;
    border-radius: 12px;
    font-weight: 700;
    cursor: pointer;
    border: none;
    transition: background-color 0.3s ease;
    user-select: none;
    box-shadow: 0 3px 10px rgba(0,0,0,0.15);
  }
  #login-panel button:first-child {
    background: var(--accent-color);
    color: white;
  }
  #login-panel button:first-child:hover {
    background: var(--accent-color-hover);
    box-shadow: 0 6px 20px var(--accent-color-hover);
  }
  #login-panel button:last-child {
    background: var(--border-color);
    color: var(--text-color);
  }
  #login-panel button:last-child:hover {
    background: #888;
    color: white;
  }

  /* –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π - —Å–ø–∏—Å–æ–∫ */
  #suggestions-list {
    max-height: 400px;
    overflow-y: auto;
    margin-top: 1rem;
    border: 1px solid var(--border-color);
    border-radius: 12px;
    background: var(--card-bg);
    box-shadow: var(--shadow-light);
    user-select: text;
  }
  #suggestions-list .suggestion-item {
    border-bottom: 1px solid var(--border-color);
    padding: 1rem 1.2rem;
    position: relative;
    font-size: 0.95rem;
    line-height: 1.3;
  }
  #suggestions-list .suggestion-item:last-child {
    border-bottom: none;
  }
  #suggestions-list .suggestion-actions {
    position: absolute;
    top: 12px;
    right: 12px;
    display: flex;
    gap: 0.6rem;
  }
  #suggestions-list .suggestion-actions button {
    background: var(--accent-color);
    border: none;
    color: white;
    font-size: 0.8rem;
    font-weight: 700;
    border-radius: 8px;
    padding: 0.3rem 0.7rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  #suggestions-list .suggestion-actions button:hover {
    background: var(--accent-color-hover);
  }

  /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
  #notifications-container {
    position: fixed;
    top: var(--header-height);
    right: 1.5rem;
    max-width: 320px;
    z-index: 11000;
    user-select: none;
  }
  .notification {
    background: var(--accent-color);
    color: white;
    padding: 1rem 1.4rem;
    margin-bottom: 1rem;
    border-radius: 14px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.35);
    font-weight: 700;
    font-size: 1rem;
    opacity: 0;
    transform: translateX(100%);
    animation: slideIn 0.5s forwards;
    cursor: default;
    user-select: none;
  }
  .notification.success {
    background: #4caf50;
  }
  .notification.error {
    background: #e53935;
  }
  .notification.info {
    background: #2196f3;
  }
  @keyframes slideIn {
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  @keyframes slideOut {
    to {
      opacity: 0;
      transform: translateX(100%);
    }
  }
</style>
</head>
<body>

<aside>
  <button onclick="showTab(event, 'news')" class="active" aria-controls="news" aria-selected="true" role="tab" id="news-tab-btn">üì∞ –ù–æ–≤–∏–Ω–∏</button>
  <button onclick="showTab(event, 'submit')" aria-controls="submit" aria-selected="false" role="tab" id="submit-tab-btn">üì® –ó–∞–ø—Ä–æ–ø–æ–Ω–æ–≤–∞–Ω—ñ</button>
  <button onclick="showTab(event, 'admin')" aria-controls="admin" aria-selected="false" role="tab" id="admin-tab-btn" style="display:none;">‚öôÔ∏è –ê–¥–º—ñ–Ω</button>
</aside>

<header>
  –¢–°–ù –ù–æ–≤–∏–Ω–∏
  <div style="display:flex; align-items:center;">
    <button id="login-btn" onclick="showLoginPanel()" title="–í—Ö—ñ–¥ –¥–ª—è –∫–æ–ø—ñ—Ä–∞–π—Ç–µ—Ä–∞">–í—Ö—ñ–¥</button>
    <button id="notification-toggle" title="–í–∫–ª—é—á–∏—Ç–∏/–≤–∏–º–∫–Ω—É—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è">–£–≤—ñ–º–∫–Ω—É—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</button>
  </div>
</header>

<main>
  <section id="news" class="active" role="tabpanel" aria-labelledby="news-tab-btn">
    <div class="tag-filter">
      <label for="tag-filter-select">–§—ñ–ª—å—Ç—Ä –∑–∞ —Ç–µ–≥–æ–º:</label>
      <select id="tag-filter-select" onchange="renderNews(this.value)" aria-controls="news-feed" aria-label="–§—ñ–ª—å—Ç—Ä –Ω–æ–≤–∏–Ω –∑–∞ —Ç–µ–≥–æ–º">
        <option value="all">–í—Å—ñ</option>
        <option value="–ü–æ–ª—ñ—Ç–∏–∫–∞">–ü–æ–ª—ñ—Ç–∏–∫–∞</option>
        <option value="–°–ø–æ—Ä—Ç">–°–ø–æ—Ä—Ç</option>
        <option value="–ö—É–ª—å—Ç—É—Ä–∞">–ö—É–ª—å—Ç—É—Ä–∞</option>
        <option value="–ì–†–ü">–ì–†–ü</option>
        <option value="–†–æ–±–æ—Ç–∞ –î–µ—Ä–∂.—Å—Ç—Ä—É–∫—Ç—É—Ä">–†–æ–±–æ—Ç–∞ –î–µ—Ä–∂.—Å—Ç—Ä—É–∫—Ç—É—Ä</option>
        <option value="–§–æ—Ç–æ—Å–µ—Å—ñ—è">–§–æ—Ç–æ—Å–µ—Å—ñ—è</option>
        <option value="–ö–æ–Ω–∫—É—Ä—Å">–ö–æ–Ω–∫—É—Ä—Å</option>
        <option value="–í–∞–∂–ª–∏–≤–µ">–í–∞–∂–ª–∏–≤–µ</option>
      </select>
    </div>
    <div id="news-feed" aria-live="polite" aria-relevant="additions"></div>
    <button style="background:#b71c1c; margin-top:2rem;" id="delete-all-btn" onclick="deleteAllNews()" title="–í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ –Ω–æ–≤–∏–Ω–∏" hidden>–í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ –Ω–æ–≤–∏–Ω–∏</button>
  </section>

  <section id="submit" role="tabpanel" aria-labelledby="submit-tab-btn">
    <div class="form-section">
      <h3>–ó–∞–ø—Ä–æ–ø–æ–Ω–æ–≤–∞–Ω—ñ –Ω–æ–≤–∏–Ω–∏</h3>
      <div id="suggestions-list" aria-live="polite" aria-relevant="additions"></div>
    </div>
  </section>

  <section id="admin" class="admin-section" role="tabpanel" aria-labelledby="admin-tab-btn">
    <div class="form-section">
      <h3>–ü—É–±–ª—ñ–∫–∞—Ü—ñ—è –Ω–æ–≤–∏–Ω–∏</h3>
      <div id="editor" contenteditable="true" aria-label="–†–µ–¥–∞–∫—Ç–æ—Ä –Ω–æ–≤–∏–Ω–∏" role="textbox" spellcheck="true"></div>
      <input type="file" id="image-upload" accept="image/*" onchange="previewImage(event)" style="margin-top: 0.5rem;"/>
      <img id="preview-image" alt="–ü—Ä–µ–≤'—é –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è" />
      <label for="tag-select" style="margin-top:1rem; display:block; font-weight:600;">–í–∏–±–µ—Ä—ñ—Ç—å —Ç–µ–≥ –Ω–æ–≤–∏–Ω–∏:</label>
      <select id="tag-select" aria-label="–í–∏–±—ñ—Ä —Ç–µ–≥—É –Ω–æ–≤–∏–Ω–∏">
        <option value="–ü–æ–ª—ñ—Ç–∏–∫–∞">–ü–æ–ª—ñ—Ç–∏–∫–∞</option>
        <option value="–°–ø–æ—Ä—Ç">–°–ø–æ—Ä—Ç</option>
        <option value="–ö—É–ª—å—Ç—É—Ä–∞">–ö—É–ª—å—Ç—É—Ä–∞</option>
        <option value="–ì–†–ü">–ì–†–ü</option>
        <option value="–†–æ–±–æ—Ç–∞ –î–µ—Ä–∂.—Å—Ç—Ä—É–∫—Ç—É—Ä">–†–æ–±–æ—Ç–∞ –î–µ—Ä–∂.—Å—Ç—Ä—É–∫—Ç—É—Ä</option>
        <option value="–§–æ—Ç–æ—Å–µ—Å—ñ—è">–§–æ—Ç–æ—Å–µ—Å—ñ—è</option>
        <option value="–ö–æ–Ω–∫—É—Ä—Å">–ö–æ–Ω–∫—É—Ä—Å</option>
        <option value="–í–∞–∂–ª–∏–≤–µ">–í–∞–∂–ª–∏–≤–µ</option>
      </select>
      <button onclick="publishNews()">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>
      <button onclick="showPreview()">–ü–µ—Ä–µ–≥–ª—è–¥</button>
    </div>
  </section>
</main>

<div id="preview-modal" onclick="hidePreview(event)" role="dialog" aria-modal="true" aria-labelledby="preview-tag" aria-describedby="preview-text">
  <div id="preview-content">
    <button id="preview-close" onclick="hidePreview(event)" aria-label="–ó–∞–∫—Ä–∏—Ç–∏ –ø–µ—Ä–µ–≥–ª—è–¥">√ó</button>
    <div class="news-tag" id="preview-tag"></div>
    <div id="preview-text"></div>
    <time id="preview-date"></time>
  </div>
</div>

<div id="login-panel" role="dialog" aria-modal="true" aria-labelledby="login-title">
  <h3 id="login-title">–í—Ö—ñ–¥ –∫–æ–ø—ñ—Ä–∞–π—Ç–µ—Ä–∞</h3>
  <input id="writer-pass" type="password" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å" autocomplete="current-password" aria-label="–ü–∞—Ä–æ–ª—å –∫–æ–ø—ñ—Ä–∞–π—Ç–µ—Ä–∞" />
  <div class="btns">
    <button onclick="loginWriter()">–£–≤—ñ–π—Ç–∏</button>
    <button onclick="closeLoginPanel()">–í—ñ–¥–º—ñ–Ω–∞</button>
  </div>
</div>

<div id="notifications-container" aria-live="polite" aria-atomic="true"></div>

<script>
  const newsFeed = document.getElementById('news-feed');
  const editor = document.getElementById('editor');
  const previewImageElem = document.getElementById('preview-image');
  const tagSelect = document.getElementById('tag-select');
  const tagFilterSelect = document.getElementById('tag-filter-select');
  const previewModal = document.getElementById('preview-modal');
  const previewText = document.getElementById('preview-text');
  const previewTag = document.getElementById('preview-tag');
  const previewDate = document.getElementById('preview-date');
  const loginPanel = document.getElementById('login-panel');
  const loginBtn = document.getElementById('login-btn');
  const adminTabBtn = document.getElementById('admin-tab-btn');
  const deleteAllBtn = document.getElementById('delete-all-btn');
  const notificationToggle = document.getElementById('notification-toggle');
  const suggestionsList = document.getElementById('suggestions-list');

  const CORRECT_PASSWORD = 'tsn2025';
  let channel = new BroadcastChannel("news_channel");

  let isWriterLoggedIn = false;
  let notificationsEnabled = false;

  // --- –õ–æ–∫–∞–ª —Å—Ç–æ—Ä–µ–¥–∂ –∫–ª—é—á—ñ ---
  const STORAGE_KEYS = {
    news: 'publishedNews',
    suggestions: 'suggestions',
    theme: 'userTheme',
    login: 'writerLoggedIn',
    notifications: 'notificationsEnabled',
    lastNewsTimestamp: 'lastNewsTimestamp'
  };

  function generateId() {
    return 'id-' + Math.random().toString(36).substr(2, 9);
  }

  function loadNews() {
    return JSON.parse(localStorage.getItem(STORAGE_KEYS.news) || '[]');
  }

  function saveNews(news) {
    localStorage.setItem(STORAGE_KEYS.news, JSON.stringify(news));
  }

  function loadSuggestions() {
    return JSON.parse(localStorage.getItem(STORAGE_KEYS.suggestions) || '[]');
  }

  function saveSuggestions(suggestions) {
    localStorage.setItem(STORAGE_KEYS.suggestions, JSON.stringify(suggestions));
  }

  function renderNews(filterTag = 'all') {
    newsFeed.innerHTML = '';
    let allNews = loadNews();
    if(filterTag !== 'all'){
      allNews = allNews.filter(n => n.tag === filterTag);
    }
    allNews.sort((a,b) => new Date(b.date) - new Date(a.date));
    if(allNews.length === 0) {
      newsFeed.innerHTML = `<p style="text-align:center; color:gray; margin-top:2rem; user-select:none;">–ù–æ–≤–∏–Ω –Ω–µ–º–∞—î.</p>`;
    }
    allNews.forEach(n => {
      const div = document.createElement('div');
      div.className = 'news';
      div.dataset.id = n.id;
      div.innerHTML = `
        <div class="news-tag">${n.tag}</div>
        <div>${n.html}</div>
        <time>${new Date(n.date).toLocaleString('uk-UA')}</time>
        <div class="actions">
          <button onclick="copyLink('${n.id}')">–ö–æ–ø—ñ—é–≤–∞—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è</button>
          ${isWriterLoggedIn ? `<button onclick="deleteNews('${n.id}')">–í–∏–¥–∞–ª–∏—Ç–∏</button>` : ''}
          <button onclick="previewNews('${n.id}')">–ü–µ—Ä–µ–≥–ª—è–¥</button>
        </div>
      `;
      newsFeed.appendChild(div);
    });
    deleteAllBtn.hidden = !isWriterLoggedIn || loadNews().length === 0;
  }

  function copyLink(id) {
    const url = new URL(window.location.href);
    url.hash = id;
    navigator.clipboard.writeText(url.toString()).then(() => {
      notify('–ü–æ—Å–∏–ª–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É!', 'success');
    });
  }

  function deleteNews(id) {
    if(confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –Ω–æ–≤–∏–Ω—É?')){
      let allNews = loadNews();
      allNews = allNews.filter(n => n.id !== id);
      saveNews(allNews);
      renderNews(tagFilterSelect.value);
      notify('–ù–æ–≤–∏–Ω–∞ –≤–∏–¥–∞–ª–µ–Ω–∞', 'info');
      updateLastNewsTimestamp();
    }
  }

  function deleteAllNews() {
    if(!isWriterLoggedIn) {
      alert('–î–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –≤—Å—ñ—Ö –Ω–æ–≤–∏–Ω –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π –≤—Ö—ñ–¥ –∫–æ–ø—ñ—Ä–∞–π—Ç–µ—Ä–∞.');
      return;
    }
    if(confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –ø–æ–≤–Ω—ñ—Å—Ç—é –≤–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ –Ω–æ–≤–∏–Ω–∏? –¶—é –¥—ñ—é –Ω–µ –º–æ–∂–Ω–∞ —Å–∫–∞—Å—É–≤–∞—Ç–∏.')) {
      localStorage.removeItem(STORAGE_KEYS.news);
      renderNews(tagFilterSelect.value);
      notify('–í—Å—ñ –Ω–æ–≤–∏–Ω–∏ –≤–∏–¥–∞–ª–µ–Ω—ñ', 'info');
      updateLastNewsTimestamp();
    }
  }

  function previewNews(id) {
    const allNews = loadNews();
    const news = allNews.find(n => n.id === id);
    if(news){
      previewTag.textContent = news.tag;
      previewText.innerHTML = news.html;
      previewDate.textContent = new Date(news.date).toLocaleString('uk-UA');
      previewModal.style.display = 'flex';
      previewModal.focus();
    }
  }

  function hidePreview(event) {
    if(event.target === previewModal || event.target.id === 'preview-close'){
      previewModal.style.display = 'none';
    }
  }

  function addNews(html, dateStr, tag) {
    const news = loadNews();
    const newNews = {id: generateId(), html, date: dateStr, tag};
    news.push(newNews);
    saveNews(news);
    renderNews(tagFilterSelect.value);
    notify('–ù–æ–≤–∏–Ω–∞ –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–∞!', 'success');
    updateLastNewsTimestamp();
    channel.postMessage(JSON.stringify(newNews));
  }

  // –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π - –†–µ–Ω–¥–µ—Ä, —É–¥–∞–ª–µ–Ω–∏–µ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö
  function renderSuggestions() {
    suggestionsList.innerHTML = '';
    const suggestions = loadSuggestions();
    if(suggestions.length === 0) {
      suggestionsList.innerHTML = `<p style="text-align:center; color:gray; margin-top:2rem; user-select:none;">–ù–µ–º–∞—î –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ–π.</p>`;
      return;
    }
    suggestions.forEach((s, idx) => {
      const div = document.createElement('div');
      div.className = 'suggestion-item';
      div.dataset.idx = idx;
      div.textContent = s;
      const actions = document.createElement('div');
      actions.className = 'suggestion-actions';

      // –ö–Ω–æ–ø–∫–∞ –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å (–≤ –∞–¥–º–∏–Ω–∫–µ, –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞)
      if(isWriterLoggedIn){
        const pubBtn = document.createElement('button');
        pubBtn.textContent = '–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏';
        pubBtn.title = '–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ —Ü—é –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—é —è–∫ –Ω–æ–≤–∏–Ω—É';
        pubBtn.onclick = () => {
          publishSuggestion(idx);
        };
        actions.appendChild(pubBtn);
      }

      // –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–∏—Ç—å
      const delBtn = document.createElement('button');
      delBtn.textContent = '–í–∏–¥–∞–ª–∏—Ç–∏';
      delBtn.title = '–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—é';
      delBtn.onclick = () => {
        deleteSuggestion(idx);
      };
      actions.appendChild(delBtn);

      div.appendChild(actions);
      suggestionsList.appendChild(div);
    });
  }

  // –ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∫–∞–∫ –Ω–æ–≤–æ—Å—Ç–∏
  function publishSuggestion(idx) {
    const suggestions = loadSuggestions();
    if(idx < 0 || idx >= suggestions.length) return;

    // –î–ª—è –Ω–æ–≤–æ—Å—Ç–∏: –±–µ—Ä–µ–º —Ç–µ–∫—Å—Ç, —Å—Ç–∞–≤–∏–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É, —Ç–µ–≥ "–í–∞–∂–ª–∏–≤–µ" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–º–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å)
    const text = suggestions[idx];
    if(!text.trim()) {
      notify('–ü—Ä–æ–ø–æ–∑–∏—Ü—ñ—è –ø–æ—Ä–æ–∂–Ω—è', 'error');
      return;
    }
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–∫ –Ω–æ–≤–æ—Å—Ç—å —Å —Ç–µ–≥–æ–º "–í–∞–∂–ª–∏–≤–µ"
    addNews(escapeHtml(text).replace(/\n/g, '<br>'), new Date().toISOString(), "–í–∞–∂–ª–∏–≤–µ");
    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
    suggestions.splice(idx, 1);
    saveSuggestions(suggestions);
    renderSuggestions();
  }

  // –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
  function deleteSuggestion(idx) {
    const suggestions = loadSuggestions();
    if(idx < 0 || idx >= suggestions.length) return;
    suggestions.splice(idx, 1);
    saveSuggestions(suggestions);
    renderSuggestions();
    notify('–ü—Ä–æ–ø–æ–∑–∏—Ü—ñ—é –≤–∏–¥–∞–ª–µ–Ω–æ', 'info');
  }

  // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
  function submitSuggestion() {
    const text = document.getElementById('suggested-news').value.trim();
    if (text) {
      const suggestions = loadSuggestions();
      suggestions.push(text);
      saveSuggestions(suggestions);
      document.getElementById('suggested-news').value = '';
      notify('–î—è–∫—É—î–º–æ –∑–∞ –≤–∞—à—É –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—é!', 'success');
      renderSuggestions();
    } else {
      notify('–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó.', 'error');
    }
  }

  function loginWriter() {
    const pass = document.getElementById('writer-pass').value;
    if (pass === CORRECT_PASSWORD) {
      isWriterLoggedIn = true;
      localStorage.setItem(STORAGE_KEYS.login, 'true');
      alert('–í—Ö—ñ–¥ —É—Å–ø—ñ—à–Ω–∏–π!');
      loginPanel.style.display = 'none';
      loginBtn.style.display = 'none';
      adminTabBtn.style.display = 'inline-flex';
      deleteAllBtn.hidden = false;
      renderNews(tagFilterSelect.value);
      renderSuggestions();
      notify('–í–∏ —É–≤—ñ–π—à–ª–∏ —è–∫ –∫–æ–ø—ñ—Ä–∞–π—Ç–µ—Ä', 'success');
    } else {
      notify('–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å', 'error');
    }
  }

  function showLoginPanel() {
    loginPanel.style.display = 'block';
    document.getElementById('writer-pass').value = '';
    document.getElementById('writer-pass').focus();
  }

  function closeLoginPanel() {
    loginPanel.style.display = 'none';
  }

  function publishNews() {
    const html = editor.innerHTML.trim();
    const tag = tagSelect.value;
    const dateStr = new Date().toISOString();
    if (html.length === 0) {
      notify('–ù–æ–≤–∏–Ω–∞ –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –ø–æ—Ä–æ–∂–Ω—å–æ—é', 'error');
      return;
    }
    addNews(html, dateStr, tag);
    editor.innerHTML = '';
    previewImageElem.style.display = 'none';
    previewImageElem.src = '';
  }

  function showPreview() {
    const html = editor.innerHTML.trim();
    const tag = tagSelect.value;
    if (!html) {
      notify('–¢–µ–∫—Å—Ç –Ω–æ–≤–∏–Ω–∏ –ø–æ—Ä–æ–∂–Ω—ñ–π', 'error');
      return;
    }
    previewTag.textContent = tag;
    previewText.innerHTML = html;
    previewDate.textContent = new Date().toLocaleString('uk-UA');
    previewModal.style.display = 'flex';
  }

  function previewImage(event) {
    const file = event.target.files[0];
    if(file){
      const reader = new FileReader();
      reader.onload = () => {
        previewImageElem.src = reader.result;
        previewImageElem.style.display = 'block';
        editor.innerHTML += `<br><img src="${reader.result}" style="max-width:100%; border-radius:6px;">`;
      };
      reader.readAsDataURL(file);
    }
  }

  // –¢–µ–º–∞ + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
  function loadTheme() {
    const savedTheme = localStorage.getItem(STORAGE_KEYS.theme);
    if(savedTheme === 'dark' || savedTheme === 'light'){
      document.documentElement.setAttribute('data-theme', savedTheme);
    } else {
      document.documentElement.setAttribute('data-theme', 'dark');
    }
  }
  function saveTheme(theme) {
    localStorage.setItem(STORAGE_KEYS.theme, theme);
  }
  function toggleTheme() {
    const theme = document.documentElement.getAttribute('data-theme');
    if(theme === 'dark'){
      document.documentElement.setAttribute('data-theme', 'light');
      saveTheme('light');
    } else {
      document.documentElement.setAttribute('data-theme', 'dark');
      saveTheme('dark');
    }
  }

  // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
  function showTab(evt, tabName) {
    // –í–∫–ª–∞–¥–∫–∏
    document.querySelectorAll('aside button').forEach(btn => {
      btn.classList.remove('active');
      btn.setAttribute('aria-selected', 'false');
    });
    evt.currentTarget.classList.add('active');
    evt.currentTarget.setAttribute('aria-selected', 'true');
    // –°–µ–∫—Ü–∏–∏
    document.querySelectorAll('main section').forEach(sec => sec.classList.remove('active'));
    document.getElementById(tabName).classList.add('active');
  }

  // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  const notificationsContainer = document.getElementById('notifications-container');
  function notify(message, type='info', timeout=3500) {
    if(!notificationsEnabled) return;
    const note = document.createElement('div');
    note.className = `notification ${type}`;
    note.textContent = message;
    notificationsContainer.appendChild(note);
    setTimeout(() => {
      note.style.animation = 'slideOut 0.5s forwards';
      setTimeout(() => notificationsContainer.removeChild(note), 500);
    }, timeout);
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—Ö–æ–¥–∞
  function checkLoginStatus() {
    const logged = localStorage.getItem(STORAGE_KEYS.login);
    if(logged === 'true'){
      isWriterLoggedIn = true;
      loginBtn.style.display = 'none';
      adminTabBtn.style.display = 'inline-flex';
      deleteAllBtn.hidden = loadNews().length === 0;
    }
  }

  // –ö–∞–Ω–∞–ª –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ—Å—Ç–∏ (BroadcastChannel)
  channel.onmessage = e => {
    try {
      const news = JSON.parse(e.data);
      // –ï—Å–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã, –∏ —ç—Ç–æ –Ω–æ–≤–∞—è –Ω–æ–≤–æ—Å—Ç—å
      if(notificationsEnabled){
        notify(`–ù–æ–≤–∞ –Ω–æ–≤–∏–Ω–∞ –≤ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó "${news.tag}"`, 'info', 5000);
      }
      // –ü–µ—Ä–µ—Ä–∏—Å—É–µ–º –Ω–æ–≤–æ—Å—Ç–∏ –µ—Å–ª–∏ —Ç–µ–∫—É—â–∏–π —Ñ–∏–ª—å—Ç—Ä –ø–æ–¥—Ö–æ–¥–∏—Ç
      if(tagFilterSelect.value === 'all' || tagFilterSelect.value === news.tag){
        renderNews(tagFilterSelect.value);
      }
    } catch {
      // ignore
    }
  };

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  function toggleNotifications() {
    notificationsEnabled = !notificationsEnabled;
    if(notificationsEnabled){
      notificationToggle.classList.add('active');
      notificationToggle.textContent = '–í–∏–º–∫–Ω—É—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è';
      notify('–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤–≤—ñ–º–∫–Ω–µ–Ω–æ', 'success', 2500);
    } else {
      notificationToggle.classList.remove('active');
      notificationToggle.textContent = '–£–≤—ñ–º–∫–Ω—É—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è';
      notify('–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤–∏–º–∫–Ω–µ–Ω–æ', 'info', 2500);
    }
    localStorage.setItem(STORAGE_KEYS.notifications, notificationsEnabled.toString());
  }

  notificationToggle.addEventListener('click', toggleNotifications);

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  function loadNotificationStatus() {
    const val = localStorage.getItem(STORAGE_KEYS.notifications);
    notificationsEnabled = val === 'true';
    if(notificationsEnabled){
      notificationToggle.classList.add('active');
      notificationToggle.textContent = '–í–∏–º–∫–Ω—É—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è';
    } else {
      notificationToggle.classList.remove('active');
      notificationToggle.textContent = '–£–≤—ñ–º–∫–Ω—É—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è';
    }
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π –Ω–æ–≤–æ—Å—Ç–∏ (–¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
  function updateLastNewsTimestamp(){
    const news = loadNews();
    if(news.length === 0){
      localStorage.removeItem(STORAGE_KEYS.lastNewsTimestamp);
    } else {
      let lastDate = news.reduce((max, n) => new Date(n.date) > max ? new Date(n.date) : max, new Date(0));
      localStorage.setItem(STORAGE_KEYS.lastNewsTimestamp, lastDate.toISOString());
    }
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–æ–≤—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  function checkNewNewsOnLoad(){
    const lastTimestamp = localStorage.getItem(STORAGE_KEYS.lastNewsTimestamp);
    if(!lastTimestamp) return;

    const news = loadNews();
    const newest = news.reduce((max, n) => new Date(n.date) > max ? new Date(n.date) : max, new Date(0));
    if(new Date(lastTimestamp) < newest){
      if(notificationsEnabled){
        notify('–Ñ –Ω–æ–≤—ñ –Ω–æ–≤–∏–Ω–∏ –∑ –º–æ–º–µ–Ω—Ç—É –≤–∞—à–æ–≥–æ –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –≤—ñ–∑–∏—Ç—É!', 'info', 7000);
      }
      updateLastNewsTimestamp();
    }
  }

  // –≠–∫—Ä–∞–Ω–∏ —ñ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
  function initialize() {
    loadTheme();
    loadNotificationStatus();
    checkLoginStatus();
    renderNews();
    renderSuggestions();
    checkNewNewsOnLoad();
  }

  // Escape HTML (–¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç XSS)
  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ hash –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –Ω–æ–≤–æ—Å—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ
  function checkHashNews() {
    if(window.location.hash) {
      const id = window.location.hash.slice(1);
      const allNews = loadNews();
      const newsItem = allNews.find(n => n.id === id);
      if(newsItem){
        previewTag.textContent = newsItem.tag;
        previewText.innerHTML = newsItem.html;
        previewDate.textContent = new Date(newsItem.date).toLocaleString('uk-UA');
        previewModal.style.display = 'flex';
      }
    }
  }

  // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã (–ø–æ –¥–≤–æ–π–Ω–æ–º—É –∫–ª–∏–∫—É –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É)
  document.querySelector('header').addEventListener('dblclick', toggleTheme);

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  initialize();
  checkHashNews();

</script>

</body>
</html>
